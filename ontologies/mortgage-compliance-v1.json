{
  "name": "mortgage-compliance-v1",
  "version": "1.0.0",
  "description": "U.S. Mortgage Compliance - Core constraints",
  "constraints": [
    {
      "id": "ATR_QM_DTI",
      "category": "ATR/QM",
      "description": "Debt-to-income ratio requirements",
      "formula_readable": "(dti ≤ 43) ∨ (compensating_factors ≥ 2)",
      "formula": {
        "or": [
          {"<=": ["dti", 43]},
          {">=": ["compensating_factors", 2]}
        ]
      },
      "variables": [
        {"name": "dti", "type": "real"},
        {"name": "compensating_factors", "type": "int"}
      ],
      "error_message": "DTI exceeds 43% without sufficient compensating factors",
      "citation": "12 CFR § 1026.43(c)"
    },
    {
      "id": "HOEPA_HIGH_COST",
      "category": "HOEPA",
      "description": "High-cost mortgage counseling requirement",
      "formula_readable": "(fee_percentage < 8) ∨ counseling_disclosed",
      "formula": {
        "or": [
          {"<": ["fee_percentage", 8]},
          {"==": ["counseling_disclosed", true]}
        ]
      },
      "variables": [
        {"name": "fee_percentage", "type": "real"},
        {"name": "counseling_disclosed", "type": "bool"}
      ],
      "error_message": "HOEPA triggered - counseling disclosure required",
      "citation": "12 CFR § 1026.32"
    },
    {
      "id": "UDAAP_NO_GUARANTEES",
      "category": "UDAAP",
      "description": "Prohibition on guarantee language",
      "formula_readable": "¬(has_guarantee ∧ has_approval)",
      "formula": {
        "not": {
          "and": [
            {"==": ["has_guarantee", true]},
            {"==": ["has_approval", true]}
          ]
        }
      },
      "variables": [
        {"name": "has_guarantee", "type": "bool"},
        {"name": "has_approval", "type": "bool"}
      ],
      "error_message": "Cannot guarantee approval",
      "citation": "12 CFR § 1036.3"
    },
    {
      "id": "HPML_ESCROW",
      "category": "Escrow",
      "description": "Escrow requirements based on FICO",
      "formula_readable": "(credit_score ≥ 620) ∨ ¬escrow_waived",
      "formula": {
        "or": [
          {">=": ["credit_score", 620]},
          {"==": ["escrow_waived", false]}
        ]
      },
      "variables": [
        {"name": "credit_score", "type": "int"},
        {"name": "escrow_waived", "type": "bool"}
      ],
      "error_message": "Cannot waive escrow with FICO < 620",
      "citation": "12 CFR § 1026.35(b)"
    },
    {
      "id": "REG_B_ADVERSE",
      "category": "Regulation B",
      "description": "Adverse action disclosure requirements",
      "formula_readable": "is_denial → has_specific_reason",
      "formula": {
        "implies": [
          {"==": ["is_denial", true]},
          {"==": ["has_specific_reason", true]}
        ]
      },
      "variables": [
        {"name": "is_denial", "type": "bool"},
        {"name": "has_specific_reason", "type": "bool"}
      ],
      "error_message": "Must disclose specific denial reason",
      "citation": "12 CFR § 1002.9"
    }
  ],
  "extractors": {
    "dti": {
      "type": "float",
      "pattern": "dti[:\\s~]*(\\d+(?:\\.\\d+)?)"
    },
    "credit_score": {
      "type": "int",
      "pattern": "(?:fico|credit score)[:\\s]*(\\d{3})"
    },
    "fees": {
      "type": "money",
      "pattern": "\\$?([\\d,]+)k?\\s*(?:fees?|costs?)"
    },
    "loan_amount": {
      "type": "money",
      "pattern": "\\$?([\\d,]+)k?\\s*(?:loan|mortgage)"
    },
    "has_guarantee": {
      "type": "boolean",
      "keywords": ["guaranteed", "100%", "definitely"]
    },
    "has_approval": {
      "type": "boolean",
      "keywords": ["approved", "approve"]
    },
    "counseling_disclosed": {
      "type": "boolean",
      "keywords": ["counseling"]
    },
    "escrow_waived": {
      "type": "boolean",
      "keywords": ["escrow waived", "waive escrow", "skip escrow"]
    },
    "is_denial": {
      "type": "boolean",
      "keywords": ["denied", "cannot approve"]
    },
    "has_specific_reason": {
      "type": "boolean",
      "keywords": ["credit", "income", "dti", "debt", "score"]
    }
  }
}
